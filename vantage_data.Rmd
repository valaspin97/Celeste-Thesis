---
title: "Vantage Pro 2 Weather Station Data"
author: "Valeria Aspinall"
date: "2026-01-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 2025 Data Upload, Reorganization & Identifying Gaps 
```{r include=FALSE}
# Packages ------------------------------------------
library(knitr)
library(readr)
library(dplyr)
library(lubridate)
library(ggplot2)
library(plotly)
library(tidyverse)
library(data.table)
```

### 2025 Monthly Data Upload
```{r}
#1. start by uploading the data for each month of data from Vantage Pro, using the na = c() 

#1a. June 2025 
raw_jun25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-06.csv", na = c("", "---")) # this replaces the --- values to NA

#1b. July 2025 
raw_jul25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-07.csv", na = c("", "---"))

#1c. August 2025 
raw_ago25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-08.csv", na = c("", "---"))

#1d. September 2025 
raw_sep25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-09.csv", na = c("", "---"))

#1e. October 2025 
raw_oct25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-10.csv", na = c("", "---"))

#1f. November 2025 
raw_nov25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-11.csv", na = c("", "---"))

#1g. December 2025 
raw_dec25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-12.csv", na = c("", "---"))
```

### Cleaning Up the Metada
```{r}
#2. merge the two metadata rows into one single row, with the words separated with and underscore _ 

#2a. create the hdr to obtain the first two rows, the show_col_types = FALSE R recommended to add it
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-06.csv", na = c("", "---"), n_max = 2, col_names = FALSE, show_col_types = FALSE)

#2b. paste the two row names into one and separating them by _ 
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_") 


```


### 06-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path 
raw_jun25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-06.csv", na = c("", "---"))

#2. merge the two metadata rows in one
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-06.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")

raw_jun25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-06.csv", na = c("", "---"), skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_jun25
data_jun25 <- raw_jun25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_jun25 <- data_jun25 %>% mutate(DateTime = as.POSIXct(DateTime))
```

## 06-2025 Identifying Gaps (Implicit & Explicit Missing Values) 
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of june 2025 
start_jun25 <- as.POSIXct("2025-06-01 00:15:00")
end_jun25   <- as.POSIXct("2025-07-01 00:00:00")

##5b. create the master sequence, 30 days, 15 min interval, should end up with 2880 observations 
jun25_full_timestamps <- seq(from = start_jun25, to = end_jun25, by = "15 min")

##5c. turn it into a master data frame: jun25_master_df
jun25_master_df <- data.frame(DateTime = jun25_full_timestamps)

##5d. make sure they are in the same time zone 
jun25_master_df <- jun25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_jun25 <- data_jun25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

#6. merge with data_jun25: jun25_final to obtain the full range of june
jun25_final <- jun25_master_df %>%
  left_join(data_jun25, by = "DateTime")

##6a. check the final row number, for 30 days = 2880 
nrow(jun25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

jun25_gap_data <- jun25_final %>%
  mutate(is_missing = is.na(!!sym(variable_to_check))) %>%
  # Identify groups of consecutive TRUE (missing) values
  mutate(gap_id = rleid(is_missing)) %>%
  filter(is_missing == TRUE) %>%
  group_by(gap_id) %>%
  summarise(
    start_time = min(DateTime),
    end_time = max(DateTime),
    duration_hours = as.numeric(difftime(max(DateTime), min(DateTime), units = "hours")) + 0.25
  )

##7a. creating a ggplot of the time gaps 
jun25_gap_fig <- ggplot(jun25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_jun25, xend = end_jun25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "June 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

jun25_gap_fig
```


## 07-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path: raw_jul25
raw_jul25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-07.csv", na = c("", "---"))

#2. merge the two metadata rows in one: raw_jul25
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-07.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")
raw_jul25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-07.csv", na = c("", "---"), skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_jul25
data_jul25 <- raw_jul25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_jul25 <- data_jul25 %>% mutate(DateTime = as.POSIXct(DateTime))
```

## 07-2025 Identifying Gaps (Implicit & Explicit Missing Values) 
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of july 2025 
start_jul25 <- as.POSIXct("2025-07-01 00:15:00")
end_jul25   <- as.POSIXct("2025-08-01 00:00:00")

##5b. create the master sequence, 31 days, 15 min interval, should end up with 2976 observations 
jul25_full_timestamps <- seq(from = start_jul25, to = end_jul25, by = "15 min")

##5c. turn it into a master data frame: jul25_master_df
jul25_master_df <- data.frame(DateTime = jul25_full_timestamps)

##5d. make sure they are in the same time zone 
jul25_master_df <- jul25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_jul25 <- data_jul25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

#6. merge with data_jul25: jul25_final
jul25_final <- jul25_master_df %>%
  left_join(data_jul25, by = "DateTime")

##6a. check the final row number, for 30 days = 2880 
nrow(jul25_final)
head(jul25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

jul25_gap_fig <- ggplot(jul25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_jul25, xend = end_jul25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "July 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

jul25_gap_fig
```


## 08-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path: raw_ago25
raw_ago25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-08.csv", na = c("", "---"))

#2. merge the two metadata rows in one: raw_ago25
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-08.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")
raw_ago25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-08.csv", na = c("", "---"), skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_ago25
data_ago25 <- raw_ago25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_ago25 <- data_ago25 %>% mutate(DateTime = as.POSIXct(DateTime))

head(data_ago25)
tail(data_ago25)
nrow(data_ago25)
```

## 08-2025 Identifying Gaps (Implicit & Explicit Missing Values) 
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of august 2025 
start_ago25 <- as.POSIXct("2025-08-01 00:15:00")
end_ago25   <- as.POSIXct("2025-09-01 00:00:00")

##5b. create the master sequence, 31 days, 15 min interval, should end up with 2976 observations 
ago25_full_timestamps <- seq(from = start_ago25, to = end_ago25, by = "15 min")

##5c. turn it into a master data frame: ago25_master_df
ago25_master_df <- data.frame(DateTime = ago25_full_timestamps)

##5d. make sure they are in the same time zone 
ago25_master_df <- ago25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_ago25 <- data_ago25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

#6. merge with data_ago25: ago25_final
ago25_final <- ago25_master_df %>%
  left_join(data_ago25, by = "DateTime")

##6a. check the final row number 
nrow(ago25_final)
head(ago25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

ago25_gap_data <- ago25_final %>%
  mutate(is_missing = is.na(!!sym(variable_to_check))) %>%
  # Identify groups of consecutive TRUE (missing) values
  mutate(gap_id = rleid(is_missing)) %>%
  filter(is_missing == TRUE) %>%
  group_by(gap_id) %>%
  summarise(
    start_time = min(DateTime),
    end_time = max(DateTime),
    duration_hours = as.numeric(difftime(max(DateTime), min(DateTime), units = "hours")) + 0.25
  )

##7a. creating a ggplot of the time gaps 
ago25_gap_fig <- ggplot(ago25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_ago25, xend = end_ago25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "August 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

ago25_gap_fig
```


## 09-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path: raw_set25
raw_sep25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-09.csv", na = c("", "---"))

#2. merge the two metadata rows in one: raw_set25
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-09.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")
raw_sep25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-09.csv", na = c("", "---"),skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_set25
data_sep25 <- raw_sep25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_sep25 <- data_sep25 %>% mutate(DateTime = as.POSIXct(DateTime))
```

## 09-2025 Identifying Gaps (Implicit & Explicit Missing Values) 
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of september 2025 
start_sep25 <- as.POSIXct("2025-09-01 00:15:00")
end_sep25   <- as.POSIXct("2025-10-01 00:00:00")

##5b. create the master sequence, 30 days, 15 min interval, should end up with 2880 observations 
sep25_full_timestamps <- seq(from = start_sep25, to = end_sep25, by = "15 min")

##5c. turn it into a master data frame: sep25_master_df
sep25_master_df <- data.frame(DateTime = sep25_full_timestamps)

##5d. make sure they are in the same time zone 
sep25_master_df <- sep25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_sep25 <- data_sep25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

#6. merge with data_sep25: sep25_final
sep25_final <- sep25_master_df %>%
  left_join(data_sep25, by = "DateTime")

##6a. check the final row number, for 30 days = 2880 
nrow(sep25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

sep25_gap_data <- sep25_final %>%
  mutate(is_missing = is.na(!!sym(variable_to_check))) %>%
  # Identify groups of consecutive TRUE (missing) values
  mutate(gap_id = rleid(is_missing)) %>%
  filter(is_missing == TRUE) %>%
  group_by(gap_id) %>%
  summarise(
    start_time = min(DateTime),
    end_time = max(DateTime),
    duration_hours = as.numeric(difftime(max(DateTime), min(DateTime), units = "hours")) + 0.25
  )

##7a. creating a ggplot of the time gaps 
sep25_gap_fig <- ggplot(sep25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_sep25, xend = end_sep25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "September 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

sep25_gap_fig
```


## 10-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path: raw_oct25
raw_oct25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-10.csv", na = c("", "---"))

#2. merge the two metadata rows in one: raw_oct25
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-10.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")
raw_oct25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-10.csv", na = c("", "---"), skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_oct25
data_oct25 <- raw_oct25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_oct25 <- data_oct25 %>% mutate(DateTime = as.POSIXct(DateTime))
```

## 10-2025 Identifying Gaps (Implicit & Explicit Missing Values)
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of oct 2025 
start_oct25 <- as.POSIXct("2025-10-01 00:15:00")
end_oct25   <- as.POSIXct("2025-11-01 00:00:00")

##5b. create the master sequence, 31 days, 15 min interval, should end up with 2976 observations 
oct25_full_timestamps <- seq(from = start_oct25, to = end_oct25, by = "15 min")

##5c. turn it into a master data frame: oct25_master_df
oct25_master_df <- data.frame(DateTime = oct25_full_timestamps)

##5d. make sure they are in the same time zone 
oct25_master_df <- oct25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_oct25 <- data_oct25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

#6. merge with data_oct25: oct25_final
oct25_final <- oct25_master_df %>%
  left_join(data_oct25, by = "DateTime")

##6a. check the final row number, for 31 days = 2976 
nrow(oct25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

oct25_gap_data <- oct25_final %>%
  mutate(is_missing = is.na(!!sym(variable_to_check))) %>%
  # Identify groups of consecutive TRUE (missing) values
  mutate(gap_id = rleid(is_missing)) %>%
  filter(is_missing == TRUE) %>%
  group_by(gap_id) %>%
  summarise(
    start_time = min(DateTime),
    end_time = max(DateTime),
    duration_hours = as.numeric(difftime(max(DateTime), min(DateTime), units = "hours")) + 0.25
  )

##7a. creating a ggplot of the time gaps 
oct25_gap_fig <- ggplot(oct25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_oct25, xend = end_oct25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "October 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

oct25_gap_fig
```


## 11-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path: raw_nov25
raw_nov25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-11.csv", na = c("", "---"))

#2. merge the two metadata rows in one: raw_nov25
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-11.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")
raw_nov25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-11.csv", na = c("", "---"), skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_nov25
data_nov25 <- raw_nov25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_nov25 <- data_nov25 %>% mutate(DateTime = as.POSIXct(DateTime))
```

## 11-2025 Identifying Gaps (Implicit & Explicit Missing Values)
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of nov 2025 
start_nov25 <- as.POSIXct("2025-11-01 00:15:00", tz = "America/Costa_Rica")
end_nov25   <- as.POSIXct("2025-12-01 00:00:00", tz = "America/Costa_Rica")

##5b. create the master sequence, 30 days, 15 min interval, should end up with 2880 observations 
nov25_full_timestamps <- seq(from = start_nov25, to = end_nov25, by = "15 min")

##5c. turn it into a master data frame: nov25_master_df
nov25_master_df <- data.frame(DateTime = nov25_full_timestamps)
nrow(nov25_master_df)

##5d. make sure they are in the same time zone 
nov25_master_df <- nov25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_nov25 <- data_nov25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

nrow(data_nov25)
head(data_nov25)

#6. merge with data_nov25: nov25_final
nov25_final <- nov25_master_df %>%
  left_join(data_nov25, by = "DateTime")

##6a. check the final row number, for 31 days = 2976 
nrow(nov25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

nov25_gap_data <- nov25_final %>%
  mutate(is_missing = is.na(!!sym(variable_to_check))) %>%
  # Identify groups of consecutive TRUE (missing) values
  mutate(gap_id = rleid(is_missing)) %>%
  filter(is_missing == TRUE) %>%
  group_by(gap_id) %>%
  summarise(
    start_time = min(DateTime),
    end_time = max(DateTime),
    duration_hours = as.numeric(difftime(max(DateTime), min(DateTime), units = "hours")) + 0.25
  )

##7a. creating a ggplot of the time gaps 
nov25_gap_fig <- ggplot(nov25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_nov25, xend = end_nov25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "November 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

nov25_gap_fig
```


## 12-2025 Data Upload & Reorganization 
```{r}
#1. upload data using read.csv and the file path: raw_dec25
raw_dec25 <- read.csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-12.csv", na = c("", "---"))

#2. merge the two metadata rows in one: raw_dec25
hdr <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-12.csv", na = c("", "---"), n_max = 2, col_names = FALSE)
col_names <- paste(hdr[1, ], hdr[2, ], sep = "_")
raw_dec25 <- read_csv("/Users/valeriaaspinall/Desktop/UGA Thesis Project /R Work - Thesis/Celeste Thesis/vantage_data/2025-12.csv", na = c("", "---"),skip = 2, col_names = col_names)

#3. mutate the date and time stamps into one column: data_nov25
data_dec25 <- raw_dec25 %>%
  mutate(DateTime = dmy_hms(paste(NA_Date, NA_Time))) %>%
  select(DateTime, everything(), -NA_Date, -NA_Time)

#4. ensuring timestamp is in the correct format 
data_dec25 <- data_dec25 %>% mutate(DateTime = as.POSIXct(DateTime))
```

## 12-2025 Identifying Gaps (Implicit & Explicit Missing Values)
```{r}
#5. expanding data frame to identify implicit missing values 
##5a. starting by defining the start and end of the month of dec 2025 
start_dec25 <- as.POSIXct("2025-12-01 00:15:00")
end_dec25   <- as.POSIXct("2026-01-01 00:00:00")

##5b. create the master sequence, 31 days, 15 min interval, should end up with 2976 observations 
dec25_full_timestamps <- seq(from = start_dec25, to = end_dec25, by = "15 min")

##5c. turn it into a master data frame: dec25_master_df
dec25_master_df <- data.frame(DateTime = dec25_full_timestamps)

##5d. make sure they are in the same time zone 
dec25_master_df <- dec25_master_df %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

data_dec25 <- data_dec25 %>%
  mutate(DateTime = force_tz(DateTime, tzone = "America/Costa_Rica"))

head(data_dec25)

#6. merge with data_nov25: nov25_final
dec25_final <- dec25_master_df %>%
  left_join(data_dec25, by = "DateTime")

##6a. check the final row number, for 31 days = 2976 
nrow(dec25_final)

#7. creating a heat map of missing values attempt 

##7a. deciding which variable to check, chose Out_Hum due to observation of it being lost first
variable_to_check <- "Out_Hum" 

dec25_gap_data <- dec25_final %>%
  mutate(is_missing = is.na(!!sym(variable_to_check))) %>%
  # Identify groups of consecutive TRUE (missing) values
  mutate(gap_id = rleid(is_missing)) %>%
  filter(is_missing == TRUE) %>%
  group_by(gap_id) %>%
  summarise(
    start_time = min(DateTime),
    end_time = max(DateTime),
    duration_hours = as.numeric(difftime(max(DateTime), min(DateTime), units = "hours")) + 0.25
  )

##7a. creating a ggplot of the time gaps 
dec25_gap_fig <- ggplot(dec25_gap_data) +
  # drawing the background line representing the entire month
  annotate("segment", x = start_dec25, xend = end_dec25, y = 1, yend = 1, 
           color = "grey", size = 2) +
  # overlay red segments on the grey segment, representing the gaps
  geom_segment(aes(x = start_time, xend = end_time, y = 1, yend = 1), 
               color = "red", size = 6) +
  # with this code, add the scale and theme of the plot
  scale_x_datetime(date_breaks = "4 days", date_labels = "%b %d") + # %b: Jan, Feb, Mar %d: day of the month
  theme_minimal() + # this removes non-essential chart elements 
  # here, the labels are consolidated
  labs(
    title = "December 2025",
    subtitle = "red bars indicate periods with no data",
    x = "", # no title for the x axis 
    y = ""  # no title for the y axis
    ) + 
  # here, the code is used to style the text elements 
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank(), 
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 9, color = "grey40")
  )

dec25_gap_fig
```

# Merging 2025 Data together 
```{r}
full_2025_data <- bind_rows(jun25_final,jul25_final,ago25_final,sep25_final,oct25_final,nov25_final,dec25_final)

full_2025_data <- full_2025_data %>%
  arrange(DateTime)

nrow(full_2025_data)

## I realized that some of the column headers were different, will fix as follows: 

#1a. create a list of all of your months 
all_months_25 <- list(jun25_final, jul25_final, ago25_final, sep25_final, oct25_final, nov25_final, dec25_final)

#1b. now fix the Out_Temp column, some where labelled as Temp_Out

fix_outtemp_column_name <- function(df) {
  df %>%
    rename_with(
      .fn = ~ str_replace(., "Temp_Out", "Out_Temp"),
      .cols = matches("Temp_Out|Out_Temp") # targets only relevant columns
    )
}

#1c. apply this to all lists and then bind the rows together again! USE THIS AS THE FINAL MERGED 2025 DATA 
corrected_all_months_25 <- lapply(all_months_25, fix_outtemp_column_name)

final_all_months_25 <- bind_rows(corrected_all_months_25)
```
```{r} 
#plotting all the missing data graphs into on figure, two ways of doing it, using with the patchwork package or gridExtra package for ggplot2 

library(gridExtra)
library(grid)
library(ggplot2)

## code to plot all of the monthly gap plots in one single figure: 
plots_list <- list(jun25_gap_fig, jul25_gap_fig , ago25_gap_fig, sep25_gap_fig, oct25_gap_fig, nov25_gap_fig, dec25_gap_fig)

plots_clean <- lapply(plots_list, function(x) {x + theme(plot.title = element_text(size = 10))} + labs(y = NULL) + labs(subtitle = NULL))

# creating the figure with a title, a caption and each plot cleanly stacked in rows as follows 
fig_month_gaps <- grid.arrange(grobs = plots_clean, 
                               nrow = 7, 
                               ncol = 1, 
                               top = textGrob("2025 Vantage Pro 2 Monthly Data Gaps", 
                                  gp = gpar(fontsize = 18, fontface = "bold")),
                               left = "", bottom = textGrob("Fig 1. Visualizing missing weather station data by month for 2025, red bars indicate missing time periods.", gp = gpar(fontsize = 12, fontface = "italic")))

# using ggsave allows you to export the figure as a png for easier use
ggsave("2025_DataGaps.png", fig_month_gaps,
       width = 9,
       height = 12,
       units = "in", # inches obvio 
       dpi = 300 # dots per incn, print quality
       )
```



## Plotly Trials using Precipitation as the Variable
```{r}
#1. trying plotly on the range of june-2025 to decemeber-2025 with precipitation 

fig_2025_rain <- plot_ly(width = 900, height = 500) %>%
  add_trace(data = final_all_months_25
            , x = ~`DateTime`, y = ~ `NA_Rain`,
            name = '2025 Precipitation', type = 'scatter', mode = 'lines',
            line = list(width = 0.8))
fig_2025_rain

#2. now trying plotly but with daily sum of precipitation 

##2a. first, obtain the daily precipitation values with the following code
daily_precip <- final_all_months_25 %>%
  # create a 'date' column that ignores the 15-min time
  mutate(Date = as.Date(DateTime)) %>%
  # group by that date
  group_by(Date) %>%
  # calculate the sum precipitation for each day
  # Use na.rm = TRUE to ignore missing values in the average
  summarise(Daily_Precip = sum(NA_Rain, na.rm = TRUE))

##2b. now, attempt using the plotly again 

fig25_daily_precip <- plot_ly(width = 900, height = 500) %>%
  add_trace(data = daily_precip, x = ~`Date`, y = ~ `Daily_Precip`,
            name = '2025 Precipitation', type = 'scatter', mode = 'lines', fill = 'tozeroy',
            line = list(width = 0.8))

fig25_daily_precip

#2c. now, attempt using plotly again but plotting it as a bar graph 

fig25_precip_bar <- plot_ly(width = 900, height = 500) %>%
  add_trace(data = daily_precip, x = ~`Date`, y = ~ `Daily_Precip`,
            name = '2025 Precipitation', type = 'bar', marker = list(color = 'rgb(158,202,225)',
                      line = list(color = 'rgb(8,48,107)',
                                  width = 1)))

fig25_precip_bar <- fig25_precip_bar %>% layout(title = "Daily Precipitation at Tapir Valley Nature Reserve",
         xaxis = list(title = "Date - Monthly 2025"),
         yaxis = list(title = "Daily Precipitation (mm)"))

fig25_precip_bar
```




